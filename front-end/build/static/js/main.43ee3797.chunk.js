(this["webpackJsonpfront-end"]=this["webpackJsonpfront-end"]||[]).push([[0],{207:function(e,t,a){e.exports=a(433)},212:function(e,t,a){},230:function(e,t,a){},292:function(e,t){},293:function(e,t){},294:function(e,t){},295:function(e,t){},296:function(e,t){},297:function(e,t){},433:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(10),i=a.n(c),o=(a(212),a(63)),l=a(26),s=a(27),u=a(24),m=a(30),d=a(31),p=a(175),h=a.n(p),v=a(44),f=a.n(v),E=a(443),b=a(435),g=a(442),w=a(434),y=a(447),k=a(440),x=a(69),C=a(445),S=(a(230),a(23)),j=a(441),O=a(448),I=a(449),L=a(450),R=a(451),P=a(452),z=a(446),N=Object(z.a)({scriptUrl:"//at.alicdn.com/t/font_1773709_52px07fzrwt.js"});function F(e){return r.a.createElement(j.a,Object.assign({mode:"horizontal"},e),r.a.createElement(j.a.Item,null,r.a.createElement(S.a,{to:"".concat("","/ai/sample")},r.a.createElement(O.a,null)," AI")),r.a.createElement(j.a.Item,null,r.a.createElement(S.a,{to:"".concat("","/setting")},r.a.createElement(I.a,null)," \u8bbe\u7f6e")),r.a.createElement(j.a.Item,null,r.a.createElement("a",{href:"https://space.bilibili.com/96740361",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(N,{type:"icon-bilibili-fill"})," B\u7ad9 EsonWong")),r.a.createElement(j.a.Item,null,r.a.createElement("a",{href:"https://www.youtube.com/channel/UCyQR6LHhhhpTFfxZo7VZddA",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(L.a,null)," Youtube EsonWong")),r.a.createElement(j.a.Item,null,r.a.createElement("a",{href:"https://github.com/itiwll/network-rc",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(R.a,null)," Github Network-rc")),r.a.createElement(j.a.Item,null,r.a.createElement("a",{href:"https://weibo.com/u/5034944416",target:"_blank",rel:"noopener noreferrer"},r.a.createElement(P.a,null)," \u5fae\u535a Eson_Wong")))}var A=a(465),D=a(470),M=a(464),T=a(466),B=a(467),_=a(468),K=a(469),U=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).handleKeyDown=function(e){var t=Object(u.a)(r).props,a=t.controller,n=a.speed,c=a.direction,i=t.onControl,o=e.key;"w"===o&&n(1),"s"===o&&n(-1),"a"===o&&c(1),"d"===o&&c(-1),i&&i()},r.handleKeyUp=function(e){var t=Object(u.a)(r).props,a=t.controller,n=a.speed,c=a.direction,i=t.onControl,o=e.key;"w"===o&&n(0),"s"===o&&n(0),"a"===o&&c(0),"d"===o&&c(0),i&&i()},r.keyboardBind=function(){var e=Object(u.a)(r),t=e.handleKeyDown,a=e.handleKeyUp;window.document.addEventListener("keydown",t,!1),window.document.addEventListener("keyup",a,!1)},r.ref=Object(n.createRef)(),r}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.keyboardBind()}},{key:"componentWillUnmount",value:function(){var e=this.handleKeyDown,t=this.handleKeyUp;window.document.removeEventListener("keydown",e,!1),window.document.removeEventListener("keyup",t,!1)}},{key:"render",value:function(){return r.a.createElement("div",null)}}]),a}(n.Component),W=a(9),G=a.n(W),V=a(20),Z=a(18),q={labelCol:{span:6},wrapperCol:{span:16}},J={wrapperCol:{offset:6,span:16}};function H(){return Q.apply(this,arguments)}function Q(){return(Q=Object(V.a)(G.a.mark((function e(){var t,a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.d("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json");case 2:return t=e.sent,a=t.getLayer("conv_pw_13_relu"),e.abrupt("return",Z.e({inputs:t.inputs,outputs:a.output}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return $.apply(this,arguments)}function $(){return($=Object(V.a)(G.a.mark((function e(t){var a,n,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=document.getElementById("small-canvas"))||((a=document.createElement("canvas")).id="small-canvas",a.width=224,a.height=224),n=Z.a.fromPixels(t),r=n.resizeNearestNeighbor([224,224]),e.next=6,Z.a.toPixels(r,a);case 6:return e.abrupt("return",a.toDataURL());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){return ee.apply(this,arguments)}function ee(){return(ee=Object(V.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var a=new Image;a.addEventListener("load",(function(){e(Z.a.fromPixels(a))})),a.src=t}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=function(){function e(){var t=this;return Object(l.a)(this,e),Object(V.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H();case 2:return t.truncatedMobileNet=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}return Object(s.a)(e,[{key:"addExample",value:function(){var e=Object(V.a)(G.a.mark((function e(t,a){var n,r,c,i,o,l;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t);case 2:n=e.sent,r=Z.j((function(){return n.expandDims(0).toFloat().div(127).sub(1)})),c=this.truncatedMobileNet.predict(r),r.dispose(),i=Z.j((function(){return Z.g(Z.i([a]).toInt(),5)})),null==this.xs?(this.xs=Z.b(c),this.ys=Z.b(i)):(o=this.xs,this.xs=Z.b(o.concat(c,0)),l=this.ys,this.ys=Z.b(l.concat(i,0)),o.dispose(),l.dispose(),i.dispose());case 8:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"clean",value:function(){this.xs&&(this.xs.dispose(),this.ys.dispose(),this.xs=null,this.ys=null)}},{key:"train",value:function(){var e=Object(V.a)(G.a.mark((function e(t,a){var n,r,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Learnning Argument",t),null!=this.xs){e.next=3;break}throw new Error("Add some examples before training!");case 3:if(n=Z.h({layers:[Z.c.flatten({inputShape:this.truncatedMobileNet.outputs[0].shape.slice(1)}),Z.c.dense({units:t.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),Z.c.dense({units:5,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]}),r=Z.k.adam(t.learnRate),n.compile({optimizer:r,loss:"categoricalCrossentropy"}),(c=Math.floor(this.xs.shape[0]*t.batchSize))>0){e.next=9;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 9:return e.next=11,n.fit(this.xs,this.ys,{batchSize:c,epochs:t.epochs,callbacks:{onBatchEnd:function(){var e=Object(V.a)(G.a.mark((function e(t,n){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loss: "+n.loss.toFixed(5)),a(n.loss.toFixed(5));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}});case 11:return this.model=n,e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=Object(V.a)(G.a.mark((function e(t){var a,n,r,c,i,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Z.j((function(){return Z.a.fromPixels(t).resizeNearestNeighbor([224,224]).expandDims(0).toFloat().div(127).sub(1)})),n=this.truncatedMobileNet.predict(a),r=this.model.predict(n),e.next=5,r.data();case 5:return c=e.sent,i=r.as1D().argMax(),e.next=9,i.data();case 9:return o=e.sent[0],console.log("Ai \u9884\u6d4b:",c),a.dispose(),e.next=14,Z.f();case 14:return e.abrupt("return",{label:o,probability:c[o]});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(V.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.save("indexeddb://".concat(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(V.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.d("indexeddb://".concat(t));case 2:this.model=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ae(e){return ne.apply(this,arguments)}function ne(){return(ne=Object(V.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){navigator.vibrate&&navigator.vibrate(e)}var ce,ie=a(194),oe=a(444),le=a(458),se=a(461),ue=a(462),me=a(453),de=a(454),pe=a(455),he=a(456),ve=a(457),fe=a(459),Ee=a(460),be=a(436),ge=a(439),we=a(437),ye=a(180),ke={left:{icon:r.a.createElement(me.a,null),name:"\u5de6\u8f6c\u5f2f",action:{speed:1,direction:1},label:0},right:{icon:r.a.createElement(de.a,null),name:"\u53f3\u8f6c\u5f2f",action:{speed:1,direction:-1},label:1},forward:{icon:r.a.createElement(pe.a,null),name:"\u524d\u8fdb",action:{speed:1,direction:0},label:2},back:{icon:r.a.createElement(he.a,null),action:{speed:-1,direction:0},name:"\u540e\u9000",label:3},stop:{icon:r.a.createElement(ve.a,null),action:{speed:0,direction:0},name:"\u505c\u6b62",label:4}},xe=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).clear=function(){n.setState({sampleList:[]})},n.upload=function(e){var t=e.file,a=e.onSuccess,r=new FileReader;return r.onload=function(e){var t=e.target.result,r=JSON.parse(t),c=n.state.sampleList;n.setState({sampleList:c.concat(r)}),a()},r.readAsText(t),!0},n.download=function(){var e=n.state,t=e.sampleList,a=e.exportName;Object(ye.saveAs)(new Blob([JSON.stringify(t)]),"".concat(a,".json"))},n.state={sampleList:e.sampleList||[],exportName:"\u81ea\u52a8\u9a7e\u9a76\u5b66\u4e60\u6837\u672c"},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!0)}},{key:"add",value:function(){var e=Object(V.a)(G.a.mark((function e(t){var a,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props.canvasRef,n=this.state.sampleList,e.t0=n,e.t1=o.a,e.t2={},e.t3=t,e.next=8,Y(a);case 8:e.t4=e.sent,e.t5={img:e.t4},e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.t0.unshift.call(e.t0,e.t6),this.setState({sampleList:n});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(e,t){this.setState((function(a){return a.sampleList[e].action=t,a}))}},{key:"remove",value:function(e){var t=this.state.sampleList;t.splice(e,1),this.setState({sampleList:t})}},{key:"render",value:function(){var e=this,t=this.clear,a=this.download,n=this.upload,c=this.props,i=c.onFinish,o=c.cameraEnabled,l=this.state.sampleList;return r.a.createElement("div",{className:"ai-sample"},r.a.createElement(b.a,{layout:"inline",className:"ai-sample-form"},Object.keys(ke).map((function(t){return r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{icon:ke[t].icon,onClick:function(){return e.add({action:t})},disabled:!o},ke[t].name))})),r.a.createElement(b.a.Item,null,r.a.createElement(be.a,{customRequest:n,accept:"application/json",showUploadList:!1},r.a.createElement(x.a,{icon:r.a.createElement(le.a,null)},"\u5bfc\u5165"))),r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{icon:r.a.createElement(fe.a,null),disabled:!l.length,onClick:a},"\u5bfc\u51fa")),r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{type:"danger",disabled:!l.length,onClick:t},"\u6e05\u9664")),r.a.createElement(b.a.Item,null,r.a.createElement(S.a,{to:"../train"},r.a.createElement(x.a,{type:"primary",disabled:l.length<10,onClick:function(){i(l)}},"\u4e0b\u4e00\u6b65")))),r.a.createElement(ge.a,{size:"small",className:"ai-example-list",grid:{gutter:16,column:4},itemLayout:"vertical",pagination:{pageSize:12},dataSource:l,renderItem:function(t,a){var n=t.img,c=t.action;return r.a.createElement(ge.a.Item,null,r.a.createElement(we.a,{size:"small",title:ke[c].icon,actions:[r.a.createElement(x.a,{size:"small",icon:r.a.createElement(Ee.a,null),type:"danger",onClick:function(){return e.remove(a)}})]},r.a.createElement("img",{style:{width:"100%"},src:n,alt:"example",onLoad:function(e){var t=e.target;t.height=.75*t.width}})))}}))}}]),a}(n.Component),Ce=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).predict=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=n.props,a=t.ai,r=t.onAi,c=void 0===r?function(){}:r,i=t.canvasRef;c(!0),n.setState({isPredicting:!0},Object(V.a)(G.a.mark((function t(){var r,o,l,s;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.state.isPredicting){t.next=13;break}return t.next=3,a.predict(i);case 3:return r=t.sent,o=r.label,l=r.probability,s=n.labelToKey(o),n.setState({actionKey:s,probability:l}),e(s),t.next=11,ae(n.state.interval);case 11:t.next=0;break;case 13:c(!1);case 14:case"end":return t.stop()}}),t)}))))},n.test=function(){n.predict()},n.drive=function(){n.predict((function(e){var t=n.props.controller,a=t.speed,r=t.direction,c=ke[e].action;a(0),a(c.speed),r(c.direction)}))},n.stop=function(){n.setState({isPredicting:!1})},n.loadModel=Object(V.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.ai.load("test");case 2:E.a.success("\u6a21\u578b\u5df2\u7ecf\u52a0\u8f7d\uff01");case 3:case"end":return e.stop()}}),e)}))),n.downloadModel=function(){},n.state={isPredicting:!1,actionKey:"stop",interval:200,probability:0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!0)}},{key:"labelToKey",value:function(e){return Object.keys(ke).find((function(t){return ke[t].label===e}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.isPredicting,n=t.actionKey,c=t.probability,i=t.interval,o=this.props,l=o.cameraEnabled,s=o.ai,u=this.drive,m=this.stop,d=this.test,p=this.loadModel;return r.a.createElement("div",{className:"ai-train"},r.a.createElement(b.a,{layout:"inline"},r.a.createElement(b.a.Item,{label:"\u64cd\u4f5c\u95f4\u9694"},r.a.createElement(oe.a,{value:i,onChange:function(t){return e.setState({interval:t})}})),r.a.createElement(b.a.Item,{label:"\u52a8\u4f5c"},r.a.createElement(C.a,null,ke[n].name," ",ke[n].icon," ",c.toFixed(2)))),r.a.createElement("br",null),r.a.createElement(b.a,{layout:"inline"},r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{icon:r.a.createElement(le.a,null),loading:a,onClick:p},"\u5bfc\u5165\u6a21\u578b")),r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{icon:r.a.createElement(se.a,null),loading:a,onClick:d,disabled:!l||!s||!s.model},"\u6d4b\u8bd5"),"\xa0\xa0\xa0\xa0",r.a.createElement(x.a,{type:"danger",key:"predic",loading:a,onClick:u,icon:r.a.createElement(O.a,null),disabled:!l||!s||!s.model},"\u5f00\u59cb Ai \u9a7e\u9a76")),r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{onClick:m,icon:r.a.createElement(ue.a,null),disabled:!a,key:"stop"},"\u505c\u6b62 Ai \u9a7e\u9a76")),r.a.createElement("br",null)))}}]),a}(n.Component),Se=a(92),je=a(463),Oe=Se.a.Option,Ie=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).train=function(){var e=Object(V.a)(G.a.mark((function e(t){var a,n,c,i,o,l,s,m;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(u.a)(r),n=a.props,c=n.sampleList,i=n.ai,r.setState({loading:"\u6570\u636e\u5904\u7406..."}),i.clean(),o=0;case 4:if(!(o<c.length)){e.next=11;break}return l=c[o],s=l.img,m=l.action,e.next=8,i.addExample(s,ke[m].label);case 8:o++,e.next=4;break;case 11:return r.setState({loading:"\u8bad\u7ec3..."}),e.next=14,i.train(t,(function(e){return r.setState({loss:e})}));case 14:r.setState({loading:!1});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.state={learnArgument:{learnRate:1e-4,batchSize:.4,epochs:20,hiddenUnits:100},loss:void 0,loading:!1,model:void 0},r.smallCanvasRef=Object(n.createRef)(),r}return Object(s.a)(a,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!1)}},{key:"render",value:function(){var e=this.state,t=e.learnArgument,a=e.loss,n=e.loading,c=this.props,i=c.sampleList,o=c.ai,l=this.train;return r.a.createElement("div",{className:"ai-train"},r.a.createElement(ie.a,{spinning:n,tip:n},r.a.createElement(b.a,Object.assign({},q,{initialValues:t,onFinish:l}),r.a.createElement(b.a.Item,{label:"Learning rate",name:"learnRate"},r.a.createElement(Se.a,null,r.a.createElement(Oe,{value:1e-5},"0.00001"),r.a.createElement(Oe,{value:1e-4},"0.0001"),r.a.createElement(Oe,{value:.001},"0.001"),r.a.createElement(Oe,{value:.003},"0.003"))),r.a.createElement(b.a.Item,{label:"Batch Size",name:"batchSize"},r.a.createElement(Se.a,null,r.a.createElement(Oe,{value:.05},"0.05"),r.a.createElement(Oe,{value:.1},"0.1"),r.a.createElement(Oe,{value:.4},"0.4"),r.a.createElement(Oe,{value:1},"1"))),r.a.createElement(b.a.Item,{label:"Epochs",name:"epochs"},r.a.createElement(Se.a,null,r.a.createElement(Oe,{value:10},"10"),r.a.createElement(Oe,{value:20},"20"),r.a.createElement(Oe,{value:40},"40"))),r.a.createElement(b.a.Item,{label:"Hidden units",name:"hiddenUnits"},r.a.createElement(Se.a,null,r.a.createElement(Oe,{value:100},"100"),r.a.createElement(Oe,{value:200},"200"),r.a.createElement(Oe,{value:300},"300"),r.a.createElement(Oe,{value:400},"400"),r.a.createElement(Oe,{value:500},"500"))),r.a.createElement(b.a.Item,{label:"loss"},r.a.createElement(oe.a,{value:a,disabled:!0})),r.a.createElement(b.a.Item,J,r.a.createElement(x.a,{key:"fit",loading:n,disabled:!i.length,icon:r.a.createElement(je.a,null),htmlType:"submit"},"\u5b66\u4e60(\u6837\u672c",i.length,")"),"\xa0 \xa0 \xa0 \xa0",r.a.createElement(x.a,{onClick:Object(V.a)(G.a.mark((function e(){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.save("test");case 2:E.a.success("\u6a21\u578b\u5df2\u7ecf\u4fdd\u5b58");case 3:case"end":return e.stop()}}),e)}))),icon:r.a.createElement(fe.a,null),disabled:!i.length},"\u5bfc\u51fa\u6a21\u578b"))),r.a.createElement(b.a,null,r.a.createElement(b.a.Item,J,r.a.createElement(S.a,{to:"../drive"},r.a.createElement(x.a,{type:"primary",disabled:!o||!o.model},"\u4e0b\u4e00\u6b65"))))))}}]),a}(n.Component),Le=[{key:"sample",name:"\u91c7\u96c6\u6837\u672c"},{key:"train",name:"\u5b66\u4e60\u8bad\u7ec3"},{key:"drive",name:"\u81ea\u52a8\u9a7e\u9a76"}],Re=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).menuItem=function(e){var t=e.key,a=e.name;return r.a.createElement(j.a.Item,{key:t},r.a.createElement(S.a,{to:"./".concat(t)},a))},n.state={learnForm:{},exampleList:[],sampleList:[],loading:!1,isPredicting:!1,loss:0},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=Object(V.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:"\u52a0\u8f7d MobileNet..."}),e.next=3,new te;case 3:t=e.sent,this.setState({loading:!1,ai:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.sampleList,n=t.ai,c=t.loading,i=this.props,o=i.controller,l=i.cameraEnabled,s=i.canvasRef,u=this.menuItem;return r.a.createElement(ie.a,{spinning:c,tip:c},r.a.createElement(S.c,{path:":current"},(function(e){return r.a.createElement(j.a,{selectedKeys:[e.match&&e.match.current],mode:"horizontal"},Le.map((function(e){return u(e)})))})),r.a.createElement(S.d,null,r.a.createElement(xe,{path:"sample",onFinish:function(t){return e.setState({sampleList:t})},sampleList:a,canvasRef:s,cameraEnabled:l,controller:o}),r.a.createElement(Ie,{path:"train",sampleList:a,controller:o,ai:n}),r.a.createElement(Ce,{path:"drive",controller:o,canvasRef:s,cameraEnabled:l,ai:n})))}}]),a}(n.Component),Pe=a(197),ze=a.n(Pe),Ne=!1;window.addEventListener("deviceorientation",(function(e){var t=e.alpha,a=e.beta,n=e.gamma;ce={alpha:t,beta:a,gamma:n},(t||Ne)&&(Ne=!0)}));var Fe=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).gamepadConnected=function(e){var t=e.gamepad,a=t.index,r=t.id;E.a.success("\u63a7\u5236\u5668\u5df2\u8fde\u63a5\u4e8e ".concat(a," \u4f4d: ").concat(r,"\u3002")),n.setState({gamepadEnabled:!0})},n.gamepadPress=function(e){var t=e.detail,a=t.index,r=t.value,c=n.props,i=c.lightEnabled,o=c.cameraEnabled,l=c.controller,s=l.changeLight,m=l.changeCamera,d=n.state.forwardPower,p=Object(u.a)(n).fixedController,h=p.speed,v=p.direction;1!==a&&13!==a&&6!==a||h(-1*r),0!==a&&12!==a&&7!==a||h(r),14===a&&v(-1*r),15===a&&v(r),9===a&&1===r&&s(!i),16===a&&1===r&&m(!o),4!==a&&2!==a||1!==r||((d-=5)<0&&(d=0),n.setState({forwardPower:d})),3!==a&&5!==a||1!==r||((d+=5)>100&&(d=100),n.setState({forwardPower:d}))},n.gamepadAxis=function(e){var t=e.detail,a=t.index,r=t.value,c=Object(u.a)(n).fixedController,i=c.speed,o=c.direction;0===a&&o(-r),3===a&&i(-r)},n.gamePadsLoop=function(){var e={},t={};n.gamePadsTime=setInterval((function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],n=function(n){var r=a[n];if(!r)return"continue";var c=r.axes,i=r.buttons;if(!r.connected)return"continue";i.forEach((function(t,a){e["".concat(n,"-").concat(a)]?(e["".concat(n,"-").concat(a)].value!==t.value&&window.dispatchEvent(new CustomEvent("gamepadpress",{detail:{index:a,value:t.value}})),e["".concat(n,"-").concat(a)]=t):e["".concat(n,"-").concat(a)]=t})),c.forEach((function(e,a){t["".concat(n,"-").concat(a)]?(t["".concat(n,"-").concat(a)].value!==e&&window.dispatchEvent(new CustomEvent("gamepadaxis",{detail:{index:a,value:e}})),t["".concat(n,"-").concat(a)]={value:e}):t["".concat(n,"-").concat(a)]={value:e}}))},r=0;r<a.length;r++)n(r)}),50)},n.deviceorientation=function(e){e.alpha;var t=e.beta,a=(e.gamma,Object(u.a)(n)),r=a.props.controller,c=a.state,i=c.directionReverse,o=c.isAiControlling,l=c.zeroOrientation;if(l&&!o){var s=t-l.beta;s=(s=s<-30?-30:s)>30?30:s,r.direction(s/30*(i?-1:1))}},n.fixedController={speed:function(e){var t=Object(u.a)(n),a=t.props.controller.speed,r=t.state,c=r.forwardPower,i=r.backwardPower;a(e*(r.speedReverse?-1:1)*((e>0?c:i)/100))},direction:function(e){var t=Object(u.a)(n),a=t.props.controller.direction,r=t.state;a(e*(r.directionReverse?-1:1)+r.directionFix)},changeCamera:function(e){return n.props.controller.changeCamera(e)}},n.fixContent=function(){var e=n.state,t=e.directionReverse,a=e.speedReverse,c=e.directionFix;return r.a.createElement(b.a,null,r.a.createElement(b.a.Item,{style:{display:Ne?void 0:"none"}},r.a.createElement(x.a,{type:"danger",onClick:function(){n.setState({zeroOrientation:Object(o.a)({},ce)})},icon:r.a.createElement(M.a,null)},"\u8235\u673a\u611f\u5e94\u6821\u51c6")),r.a.createElement(b.a.Item,{label:"\u8235\u673a\u53cd\u5411"},r.a.createElement(w.a,{checked:t,onChange:function(e){n.setState({directionReverse:e}),f.a.set("directionReverse",e)}})),r.a.createElement(b.a.Item,{label:"\u6cb9\u95e8\u53cd\u5411"},r.a.createElement(w.a,{checked:a,onChange:function(e){n.setState({speedReverse:e}),f.a.set("speedReverse",e)}})),r.a.createElement(b.a.Item,{label:"\u8235\u673a\u5fae\u8c03"},r.a.createElement(k.a,{value:50*c+50,min:0,max:100,included:!1,onChange:function(e){var t=e/50-1;f.a.set("directionFix",t),n.setState({directionFix:t},(function(){n.fixedController.direction(0)}))},style:{width:"50vw"}})))},n.state={zeroOrientation:void 0,directionReverse:f.a.get("directionReverse")||!1,speedReverse:f.a.get("speedReverse")||!1,backwardPower:50,forwardPower:50,directionFix:f.a.get("directionFix")||0,isShowButton:ze()(),gamepadEnabled:!1},n}return Object(s.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("deviceorientation",this.deviceorientation),window.addEventListener("gamepadconnected",this.gamepadConnected),window.addEventListener("gamepaddisconnected",this.gamepadDisconnected),window.addEventListener("gamepadpress",this.gamepadPress),window.addEventListener("gamepadaxis",this.gamepadAxis),this.gamePadsLoop()}},{key:"componentWillUnmount",value:function(){clearInterval(this.gamePadsTime),window.removeEventListener("deviceorientation",this.deviceorientation),window.removeEventListener("gamepadconnected",this.gamepadConnected),window.removeEventListener("gamepaddisconnected",this.gamepadDisconnected),window.removeEventListener("gamepadpress",this.gamepadPress),window.removeEventListener("gamepadaxis",this.gamepadAxis),window.removeEventListener("deviceorientation",this.handleSetZeroOrientation)}},{key:"gamepadDisconnected",value:function(e){var t=e.gamepad,a=t.index,n=t.id;E.a.error("\u63a7\u5236\u5668\u4f4d".concat(n,"-").concat(a,"\u5df2\u65ad\u5f00\u3002"))}},{key:"render",value:function(){var e=this,t=this.fixContent,a=this.fixedController,c=this.props,i=c.action,o=c.cameraEnabled,l=c.canvasRef,s=this.state,u=s.gamepadEnabled,m=s.forwardPower,d=s.backwardPower,p=s.isShowButton,h=a.speed,v=a.direction;return r.a.createElement("div",{className:"controller"},r.a.createElement(b.a,{className:"controller-form",size:"small",layout:"inline"},r.a.createElement(b.a.Item,null,r.a.createElement(y.a,{content:t,title:"\u4fee\u6b63",trigger:"click"},r.a.createElement(x.a,{icon:r.a.createElement(A.a,null)},"\u4fee\u6b63"))),p&&r.a.createElement(n.Fragment,null,r.a.createElement(x.a,{className:"left-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){v(1),re(50)},onTouchEnd:function(){v(0)},icon:r.a.createElement(T.a,null),style:{display:Ne?"none":void 0}}),r.a.createElement(x.a,{className:"right-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){v(-1),re(50)},onTouchEnd:function(){v(0)},icon:r.a.createElement(B.a,null),style:{display:Ne?"none":void 0}}),r.a.createElement(x.a,{className:"forward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){h(1),re(300)},onTouchEnd:function(){h(0)},icon:r.a.createElement(_.a,null)}),r.a.createElement(x.a,{className:"backward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){h(-1),re([100,50,100])},onTouchEnd:function(){h(0)},icon:r.a.createElement(K.a,null)})),r.a.createElement(b.a.Item,null,r.a.createElement(y.a,{placement:"topLeft",content:r.a.createElement(k.a,{value:m,min:0,max:100,onChange:function(t){e.setState({forwardPower:t})},arrowPointAtCenter:!0,style:{width:"30vw"}})},r.a.createElement(x.a,{shape:"round"},"\u524d\u8fdb\u6cb9\u95e8:",m))),r.a.createElement(b.a.Item,null,r.a.createElement(y.a,{placement:"topLeft",content:r.a.createElement(k.a,{value:d,min:0,max:100,style:{width:"30vw"},onChange:function(t){e.setState({backwardPower:t})}})},r.a.createElement(x.a,{shape:"round"},"\u5012\u9000\u6cb9\u95e8:",d))),r.a.createElement(b.a.Item,null,r.a.createElement(w.a,{checked:p,onChange:function(t){return e.setState({isShowButton:t})},checkedChildren:r.a.createElement(D.a,null),unCheckedChildren:r.a.createElement(D.a,null)})),r.a.createElement(b.a.Item,null,r.a.createElement(w.a,{checked:u,onChange:function(t){t?e.gamePadsLoop():clearInterval(e.gamePadsTime),e.setState({gamepadEnabled:t})},unCheckedChildren:r.a.createElement(N,{type:"icon-game-"}),checkedChildren:r.a.createElement(N,{type:"icon-game-"})})),r.a.createElement(b.a.Item,null,r.a.createElement(C.a,null,"\u952e\u76d8:wsad"))),r.a.createElement(U,{controller:{speed:h,direction:v}}),r.a.createElement(S.d,null,r.a.createElement(Re,{path:"ai/*",canvasRef:l,cameraEnabled:o,action:i,controller:a,onAi:function(t){return e.setState({isAiControlling:t})}})))}}]),a}(n.Component),Ae=a(206),De=a(438),Me=Se.a.Option;function Te(e){e.onDisconnect,e.wsConnected;var t=e.onSubmit,a=e.serverSetting,n=Object(Ae.a)(e,["onDisconnect","wsConnected","onSubmit","serverSetting"]);return r.a.createElement(b.a,Object.assign({},q,{onFinish:t,initialValues:n}),r.a.createElement("br",null),r.a.createElement(b.a.Item,{label:"\u8fde\u63a5\u5730\u5740",name:"wsAddress",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740!"}]},r.a.createElement(De.a,null)),r.a.createElement(b.a.Item,{label:"\u6700\u5927\u901f\u5ea6",name:"speedMax"},r.a.createElement(k.a,{min:0,max:a.maxSpeed,tooltipVisible:!0})),r.a.createElement(b.a.Item,{label:"\u6444\u50cf\u5934\u6a21\u5f0f",name:"cameraMode"},r.a.createElement(Se.a,null,r.a.createElement(Me,{value:"default"},"300p-30fps(\u9ed8\u8ba4)"),r.a.createElement(Me,{value:"480p-15fps"},"480p-15fps"),r.a.createElement(Me,{value:"600p"},"600p-30fps"))),r.a.createElement(b.a.Item,J,r.a.createElement(x.a,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58")))}var Be=a(200),_e=a.n(Be),Ke=a(471),Ue=a(472),We=a(473),Ge=a(474),Ve=a(475),Ze=a(476),qe=a(477);function Je(e){var t=e.onSubmit;return r.a.createElement(b.a,Object.assign({},q,{onFinish:t}),r.a.createElement(b.a.Item,{label:"\u5bc6\u7801",name:"password"},r.a.createElement(De.a,{type:"password"})),r.a.createElement(b.a.Item,J,r.a.createElement(x.a,{type:"primary",htmlType:"submit"},"\u767b\u5f55")))}var He=a(201),Qe=a.n(He),Ye=a(202),$e=a.n(Ye),Xe=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;Object(l.a)(this,a),(r=t.call(this,e)).connect=function(){var e=r.state.setting.wsAddress;r.wsavc.connect("".concat("https:"===window.location.protocol?"wss://":"ws://").concat(e))},r.disconnect=function(e){e&&e.preventDefault(),r.setState({wsConnected:!1}),r.wsavc&&r.wsavc.disconnect()},r.login=function(e){var t=e.password;r.state.wsConnected&&r.wsavc.send("login",{token:Qe()("".concat(t,"eson"))})},r.changeCamera=function(e){var t=Object(u.a)(r).state,a=t.setting.cameraMode;t.wsConnected&&r.wsavc.send("open camera",{enabled:e,cameraMode:a})},r.changeLight=function(e){r.state.wsConnected&&r.wsavc.send("open light",e)},r.changeSetting=function(e){r.setState({setting:e}),f.a.set("setting",e),Object(S.e)("".concat("","/"))},r.changeZeroSpeedRate=function(e){r.state.wsConnected&&(r.wsavc.send("speed zero rate",e),r.setState({speedZeroRate:e}))},r.changeSpeed=function(e){r.state.wsConnected&&r.wsavc.send("speed rate",e)},r.changeDirection=function(e){r.state.wsConnected&&r.wsavc.send("direction rate",e)},r.appRef=Object(n.createRef)(),r.playerBoxRef=Object(n.createRef)(),r.state={setting:Object(o.a)({speedMax:20,wsAddress:window.location.host,cameraMode:"default"},f.a.get("setting")),serverSetting:{maxSpeed:100},wsConnected:!1,cameraEnabled:!1,lightEnabled:!1,canvasRef:void 0,isAiControlling:!1,isFullscreen:!1,videoSize:50,delay:void 0,action:{speed:0,direction:0}};var c=Object(u.a)(r),i=c.changeCamera,s=c.changeLight;return r.controller={changeLight:s,changeCamera:i,speed:function(e){var t=Object(u.a)(r),a=t.changeSpeed,n=t.state,c=n.setting.speedMax,i=n.action;i.speed=e*c/100,r.setState({action:Object(o.a)({},i)}),a(i.speed)},direction:function(e){var t=Object(u.a)(r),a=t.changeDirection,n=t.state.action;n.direction=e,a(e),r.setState({action:Object(o.a)({},n)})}},r.changeVideoSize=$e()((function(){r.setState({unbounceVideoSize:r.state})}),300),r}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e,t=this,a=this.connect;this.wsavc=new _e.a({useWorker:!0,workerFile:"".concat("","/Decoder.js")}),this.wsavc.on("pong",(function(e){var a=e.sendTime;t.setState({delay:((new Date).getTime()-a)/2})})),this.wsavc.on("controller init",(function(e){var a=e.needPassword,n=e.maxSpeed;t.setState({serverSetting:{maxSpeed:n,needPassword:a}}),a&&Object(S.e)("".concat("","/login"))})),this.wsavc.on("disconnected",(function(){console.log("WS disconnected"),t.setState({wsConnected:!1,cameraEnabled:!1}),clearInterval(e)})),this.wsavc.on("connected",(function(){console.log("WS connected"),t.setState({wsConnected:!0}),e=setInterval((function(){var e=(new Date).getTime();t.wsavc.send("ping",{sendTime:e})}),1e3)})),this.wsavc.on("frame_shift",(function(e){})),this.wsavc.on("resized",(function(e){console.log("resized",e)})),this.wsavc.on("stream_active",(function(e){console.log("Stream is ",e?"active":"offline"),e?(t.playerBoxRef.current.appendChild(t.wsavc.AvcPlayer.canvas),t.setState({cameraEnabled:e,canvasRef:t.wsavc.AvcPlayer.canvas})):t.setState({cameraEnabled:e,canvasRef:void 0})})),this.wsavc.on("light enabled",(function(e){t.setState({lightEnabled:e})})),this.wsavc.on("login",(function(e){var t=e.message;E.a.success(t),Object(S.e)("".concat("","/"))})),this.wsavc.on("error",(function(e){var t=e.message;E.a.error(t)})),a(),document.body.addEventListener("fullscreenchange",(function(){document.fullscreenElement?t.setState({isFullscreen:!0}):t.setState({isFullscreen:!1})}))}},{key:"render",value:function(){var e=this,t=this.disconnect,a=this.connect,n=this.controller,c=this.changeSetting,i=this.changeLight,o=this.changeCamera,l=this.login,s=this.state,u=s.setting,m=s.wsConnected,d=s.cameraEnabled,p=s.canvasRef,v=s.action,f=s.isFullscreen,E=s.serverSetting,j=s.lightEnabled,O=s.videoSize,I=s.delay;return r.a.createElement("div",{className:"App",ref:this.appRef},r.a.createElement(b.a,{layout:"inline",className:"app-status",size:"small"},r.a.createElement(b.a.Item,null,r.a.createElement(S.b,null,(function(e){var t=e.navigate;return r.a.createElement(g.a.Button,{overlay:F,onClick:function(){return t("".concat("","/"))},type:"primary"},r.a.createElement(Ke.a,null)," \u63a7\u5236")}))),r.a.createElement(b.a.Item,null,r.a.createElement(w.a,{checked:m,onChange:function(e){e?a():t()},unCheckedChildren:r.a.createElement(Ue.a,null),checkedChildren:r.a.createElement(Ue.a,null)})),r.a.createElement(b.a.Item,null,r.a.createElement(w.a,{checked:d,onChange:o,checkedChildren:r.a.createElement(We.a,null),unCheckedChildren:r.a.createElement(We.a,null)})),d&&r.a.createElement(b.a.Item,null,r.a.createElement(y.a,{placement:"bottomRight",content:r.a.createElement(k.a,{defaultValue:O,step:.1,tipFormatter:function(e){return 2*e},onAfterChange:function(t){return e.setState({videoSize:t})},style:{width:"30vw"},marks:{0:0,50:100,100:200}})},r.a.createElement(x.a,{shape:"round"},r.a.createElement(Ge.a,null),(2*O).toFixed(1),"%"))),r.a.createElement(b.a.Item,null,r.a.createElement(w.a,{checked:j,onChange:i,checkedChildren:r.a.createElement(Ve.a,null),unCheckedChildren:r.a.createElement(Ve.a,null)})),document.body.requestFullscreen&&r.a.createElement(b.a.Item,null,r.a.createElement(x.a,{type:"primary",shape:"circle",icon:f?r.a.createElement(Ze.a,null):r.a.createElement(qe.a,null),onClick:function(){f?document.exitFullscreen():document.body.requestFullscreen()}})),m&&I&&r.a.createElement(b.a.Item,null,r.a.createElement(C.a,{color:I>80?"red":"green"},"ping:",I))),r.a.createElement(S.d,{className:"app-page"},r.a.createElement(Te,Object.assign({path:"".concat("","/setting")},u,{serverSetting:E,wsConnected:m,onDisconnect:t,onSubmit:c})),r.a.createElement(Je,{path:"".concat("","/login"),onSubmit:l}),r.a.createElement(Fe,{path:"".concat("","/*"),controller:n,lightEnabled:j,cameraEnabled:d,canvasRef:p,action:v})),r.a.createElement("div",{className:"player-box",ref:this.playerBoxRef,style:{opacity:d?1:0,transform:"scale(".concat(O/50,")")}}),r.a.createElement(h.a,{preventSleep:m}))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Xe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[207,1,2]]]);
//# sourceMappingURL=main.43ee3797.chunk.js.map