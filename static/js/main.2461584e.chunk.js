(this["webpackJsonpfront-end"]=this["webpackJsonpfront-end"]||[]).push([[0],{178:function(e,t,a){e.exports=a(370)},183:function(e,t,a){},194:function(e,t,a){},200:function(e,t){},201:function(e,t){},202:function(e,t){},203:function(e,t){},204:function(e,t){},205:function(e,t){},370:function(e,t,a){"use strict";a.r(t);var n,r,s=a(0),c=a.n(s),i=a(16),o=a.n(i),l=(a(183),a(77)),d=a(36),u=a(37),m=a(29),p=a(47),h=a(48),f=a(30),v=a.n(f),b=a(380),E=a(381),g=a(382),y=a(383),w=a(125),k=a(372),x=a(371),R=a(376),S=a(126),j=a(373),O=a(375),C=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).keyboardBind=function(){var e=Object(m.a)(n).props,t=e.controller,a=t.speed,r=t.direction,s=e.onControl;window.document.addEventListener("keydown",(function(e){var t=e.key;"w"===t&&a(1),"s"===t&&a(-1),"a"===t&&r(1),"d"===t&&r(-1),s&&s()}),!1),window.document.addEventListener("keyup",(function(e){var t=Object(m.a)(n).props,a=t.controller,r=a.speed,s=a.direction,c=t.onControl,i=e.key;"w"===i&&r(0),"s"===i&&r(0),"a"===i&&s(0),"d"===i&&s(0),c&&c()}),!1)},n.ref=Object(s.createRef)(),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.keyboardBind()}},{key:"render",value:function(){return c.a.createElement("div",null)}}]),a}(s.Component),A=(a(194),function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).setCanvasRef=function(t){n.canvasRef=t,e.setCanvasRef&&e.setCanvasRef(t)},n}return Object(u.a)(a,[{key:"componentWillReceiveProps",value:function(e){e.disabled!==this.props.disabled&&(e.disabled?this.disconnect():this.connect())}},{key:"connect",value:function(){var e=this,t=this.props.address;t&&(this.wsavc=new window.WSAvcPlayer(this.canvasRef,"webgl",1,35),this.wsavc.connect("".concat("https:"===window.location.protocol?"wss":"ws","://").concat(t),(function(){e.wsavc.playStream()})))}},{key:"disconnect",value:function(){this.wsavc&&(this.wsavc.disconnect(),this.wsavc.initCanvas(),this.wsavc=void 0)}},{key:"render",value:function(){return c.a.createElement("div",{className:"player"},c.a.createElement("canvas",{className:"canvas",ref:this.setCanvasRef}))}}]),a}(s.Component)),I=a(173),M=a(10),W=a.n(M),z=a(26),N=a(75),P=a(158),L=a(374),T=a(377),D=a(11),F=a(378),Z=a(379),B={labelCol:{span:6},wrapperCol:{span:16}},H={wrapperCol:{offset:6,span:16}},_={0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"};function q(){return U.apply(this,arguments)}function U(){return(U=Object(z.a)(W.a.mark((function e(){var t,a;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.d("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json");case 2:return t=e.sent,a=t.getLayer("conv_pw_13_relu"),e.abrupt("return",D.e({inputs:t.inputs,outputs:a.output}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return J.apply(this,arguments)}function J(){return(J=Object(z.a)(W.a.mark((function e(t){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $,G=new(function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"addExample",value:function(e,t){var a=D.i((function(){return D.h(t,[1,2])}));if(null==this.xs)this.xs=D.b(e),this.ys=D.b(a);else{var n=this.xs;this.xs=D.b(n.concat(e,0));var r=this.ys;this.ys=D.b(r.concat(a,0)),n.dispose(),r.dispose(),a.dispose()}}},{key:"clean",value:function(){this.xs.dispose(),this.ys.dispose(),this.xs=null,this.ys=null}}]),e}()),K=N.a.Option,Q=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var c;return Object(d.a)(this,a),(c=t.call(this,e)).exampleCleanHandler=Object(z.a)(W.a.mark((function e(){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.setState({exampleList:[]}),G.clean();case 2:case"end":return e.stop()}}),e)}))),c.exampleHandler=function(){var e=Object(z.a)(W.a.mark((function e(t){var a,r,s,i,o,l,d,u,p,h,f;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(m.a)(c),r=a.state.exampleList,s=a.props,i=s.action,o=s.canvasRef,l=D.a.fromPixels(o),d=l.resizeNearestNeighbor([224,224]),u=D.i((function(){return d.expandDims(0).toFloat().div(127).sub(1)})),h=(p=t||i).speed,f=p.direction,console.log("example",p),G.addExample(n.predict(u),[(h+1)/2,(f+1)/2]),e.next=10,D.a.toPixels(d,c.smallCanvasRef.current);case 10:r.push({img:c.smallCanvasRef.current.toDataURL(),action:{speed:h,direction:f}}),c.setState({exampleList:r}),l.dispose();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.train=function(){var e=Object(z.a)(W.a.mark((function e(t){var a,s;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.setState({isTraining:!0}),console.log("Learnning Argument",t),null!=G.xs){e.next=4;break}throw new Error("Add some examples before training!");case 4:if(r=D.g({layers:[D.c.flatten({inputShape:n.outputs[0].shape.slice(1)}),D.c.dense({units:t.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),D.c.dense({units:2,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]}),a=D.j.adam(t.learnRate),r.compile({optimizer:a,loss:"meanSquaredError"}),(s=Math.floor(G.xs.shape[0]*t.batchSize))>0){e.next=10;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 10:r.fit(G.xs,G.ys,{batchSize:s,epochs:t.epochs,callbacks:{onBatchEnd:function(){var e=Object(z.a)(W.a.mark((function e(t,a){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loss: "+a.loss.toFixed(5)),c.setState({loss:a.loss.toFixed(5)});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),onTrainEnd:function(e){var t=e.loss.toFixed(5);console.log("Train End Loss: "+e.loss.toFixed(5)),c.setState({isTraining:!1,loss:t})}}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.predict=Object(z.a)(W.a.mark((function e(){var t,a,s,i;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(m.a)(c),a=t.props,s=a.canvasRef,(i=a.onAi)(!0),c.setState({isPredicting:!0},Object(z.a)(W.a.mark((function e(){var t,a,o,l,d,u,m,p;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.state.isPredicting){e.next=20;break}return t=D.i((function(){return D.a.fromPixels(s).resizeNearestNeighbor([224,224]).expandDims(0).toFloat().div(127).sub(1)})),a=n.predict(t),o=r.predict(a),e.next=6,o.data();case 6:return l=e.sent,d=Object(I.a)(l,2),u=d[0],m=d[1],p={speed:2*u-1,direction:2*m-1},console.log("Ai \u52a8\u4f5c\uff1a",p),t.dispose(),c.doAction(p),e.next=16,V(200);case 16:return e.next=18,D.f();case 18:e.next=0;break;case 20:i(!1);case 21:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)}))),c.record=Object(z.a)(W.a.mark((function e(){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.setState({isRecording:!0});case 1:case"end":return e.stop()}}),e)}))),c.state={learnForm:{},exampleList:[],loading:!1,training:!1,isPredicting:!1,isRecording:!1,loss:0,learnArgument:{learnRate:.001,batchSize:.4,epochs:20,hiddenUnits:100}},c.smallCanvasRef=Object(s.createRef)(),c}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=Object(z.a)(W.a.mark((function e(){return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,q();case 3:n=e.sent,this.setState({loading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){e.action!==this.props.action&&this.state.isRecording&&this.exampleHandler(this.props.action)}},{key:"doAction",value:function(){var e=Object(z.a)(W.a.mark((function e(t){var a;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.speed,a=t.direction,this.props.controller.direction(a);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.exampleList,n=t.loading,r=t.isRecording,s=t.isTraining,i=t.isPredicting,o=t.loss,l=t.learnArgument,d=this.exampleHandler,u=this.exampleCleanHandler,m=this.record,p=this.predict;return c.a.createElement(P.a,{spinning:n},c.a.createElement("canvas",{className:"ai-canvas",ref:this.smallCanvasRef}),c.a.createElement(k.a,Object.assign({},B,{initialValues:l,onFinish:this.train}),c.a.createElement(k.a.Item,{label:"Learning rate",name:"learnRate"},c.a.createElement(R.a,null)),c.a.createElement(k.a.Item,{label:"Batch Size",name:"batchSize"},c.a.createElement(N.a,null,c.a.createElement(K,{value:.05},"0.05"),c.a.createElement(K,{value:.1},"0.1"),c.a.createElement(K,{value:.4},"0.4"),c.a.createElement(K,{value:1},"1"))),c.a.createElement(k.a.Item,{label:"Epochs",name:"epochs"},c.a.createElement(N.a,null,c.a.createElement(K,{value:10},"10"),c.a.createElement(K,{value:20},"20"),c.a.createElement(K,{value:40}),"40")),c.a.createElement(k.a.Item,{label:"Hidden units",name:"hiddenUnits"},c.a.createElement(N.a,null,c.a.createElement(K,{value:100},"100"),c.a.createElement(K,{value:200},"200"),c.a.createElement(K,{value:300},"300"),c.a.createElement(K,{value:400},"400"),c.a.createElement(K,{value:500},"500"))),c.a.createElement(k.a.Item,{label:"loss"},c.a.createElement(R.a,{value:o})),c.a.createElement(k.a.Item,H,c.a.createElement(S.a,{type:"primary",htmlType:"submit",key:"fit",loading:s,disabled:!a.length},"\u5b66\u4e60"))),c.a.createElement(k.a,Object.assign({},B,{initialValues:{speed:0,direction:0},onFinish:function(e){return d(e)}}),c.a.createElement(k.a.Item,{name:"speed",label:"\u901f\u5ea6",required:!0},c.a.createElement(R.a,null)),c.a.createElement(k.a.Item,{name:"direction",label:"\u65b9\u5411",required:!0},c.a.createElement(R.a,null)),c.a.createElement(k.a.Item,Object.assign({},H,{className:"form-item-button"}),c.a.createElement(S.a,{key:"record-once",htmlType:"submit",type:"primary",icon:c.a.createElement(F.a,null)}),c.a.createElement(S.a,{type:"primary",key:"record",loading:r,onClick:m},"\u5f00\u59cb\u8bb0\u5f55"),c.a.createElement(S.a,{key:"stop",onClick:function(){e.setState({isRecording:!1})},disabled:!r},"\u505c\u6b62\u8bb0\u5f55"),c.a.createElement(S.a,{type:"danger",disabled:!a.length,onClick:u},"\u6e05\u9664")),c.a.createElement(k.a.Item,Object.assign({},H,{className:"form-item-button"}),c.a.createElement(S.a,{type:"danger",key:"predic",loading:i,onClick:p},"\u5f00\u59cb Ai \u9a7e\u9a76"),c.a.createElement(S.a,{onClick:function(){e.setState({isPredicting:!1})},disabled:!i,key:"stop"},"\u505c\u6b62 Ai \u9a7e\u9a76"))),c.a.createElement(L.a,{size:"small",className:"ai-example-list",grid:{gutter:16,column:4},itemLayout:"vertical",pagination:{pageSize:12},dataSource:a,renderItem:function(e){var t=e.img,a=e.action,n=a.speed,r=a.direction;return c.a.createElement(L.a.Item,null,c.a.createElement(T.a,{size:"small",title:"\u901f\u5ea6\uff1a".concat(n,"    \u65b9\u5411\uff1a").concat(r),actions:[c.a.createElement(S.a,{size:"small",icon:c.a.createElement(Z.a,null),type:"danger"})]},c.a.createElement("img",{style:{maxWidth:"100%"},src:t,alt:"example"})))}}))}}]),a}(s.Component),X=w.a.TabPane;window.addEventListener("deviceorientation",(function(e){var t=e.alpha,a=e.beta,n=e.gamma;$={alpha:t,beta:a,gamma:n}}));var Y=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).deviceorientation=function(){var e=Object(m.a)(n),t=(e.changeSpeed,e.changeDirection),a=e.state,r=(a.hold,a.base),s=(r.gamma,r.beta),c=a.directionReverse;a.speedZeroRate,a.speedMaxRate,a.speedReverseMaxRate;if(!a.isAiControlling){var i=$.beta-s;i=(i=i<-30?-30:i)>30?30:i,t(5*(c?-i/30:i/30)+7.5)}},n.connectWs=function(e){var t=e.wsAddress,a=e.playerWsAddress;t&&(n.socket&&(n.socket.close(),n.socket=void 0),n.socket=window.io(t),n.socket.on("connect",(function(){n.setState({wsConnected:!0}),n.changeZeroSpeedRate(n.state.speedZeroRate),v.a.set("wsAddress",t)})),n.socket.on("disconnect",(function(){n.setState({wsConnected:!1})})),a&&(n.setState({playerWsAddress:a}),v.a.set("playerWsAddress",a)))},n.disconnectWs=function(e){e&&e.preventDefault(),n.socket.close()},n.handleHold=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(n.socket.emit("speed rate",0),n.socket.emit("direction rate",0)),n.setState({hold:e,base:Object(l.a)({},$)})},n.changeZeroSpeedRate=function(e){n.state.wsConnected&&(n.socket.emit("speed zero rate",e),n.setState({speedZeroRate:e}))},n.changeSpeed=function(e){n.state.wsConnected&&(n.socket.emit("speed rate",e),n.setState({speedRate:e}))},n.changeDirection=function(e){n.state.wsConnected&&(n.socket.emit("direction rate",e),n.setState({direction:e}))},n.appRef=c.a.createRef(),n.state={hold:!1,speed:0,direction:0,base:{alpha:void 0,beta:void 0,gamma:void 0},speedMaxRate:v.a.get("speedMaxRate")||80,speedReverseMaxRate:v.a.get("speedReverseMaxRate")||70,speedZeroRate:v.a.get("speedZeroRate")||75,speedRate:0,directionReverse:v.a.get("directionReverse")||!0,wsConnected:!1,wsAddress:v.a.get("wsAddress"),playerWsAddress:v.a.get("playerWsAddress"),playerEnabled:!1,canvasRef:void 0,isAiControlling:!1,action:{speed:0,direction:0}},n.controller={speed:function(e){var t=Object(m.a)(n),a=t.changeSpeed,r=t.state,s=r.speedMaxRate,c=r.speedReverseMaxRate,i=r.speedZeroRate,o=r.action;o.speed=e;var d=e>0?i+(s-i)*e:i+(i-c)*e;n.setState({action:Object(l.a)({},o)}),a(d)},direction:function(e){var t=Object(m.a)(n),a=t.changeDirection,r=t.state.action;r.direction=e,a(5*e+7.5),n.setState({action:Object(l.a)({},r)})}},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this.deviceorientation,t=this.connectWs,a=this.state.wsAddress;window.addEventListener("deviceorientation",(function(){e()}),!1),t({wsAddress:a})}},{key:"render",value:function(){var e=this,t=this.connectWs,a=this.disconnectWs,n=this.changeSpeed,r=this.changeDirection,s=this.controller,i=this.state,o=i.wsConnected,d=i.directionReverse,u=i.direction,m=i.speedReverseMaxRate,p=i.speedMaxRate,h=i.speedZeroRate,f=i.speedRate,I=i.wsAddress,M=i.playerWsAddress,W=i.playerEnabled,z=i.canvasRef,N=i.action;return c.a.createElement("div",{className:"App",ref:this.appRef},c.a.createElement(k.a,{layout:"inline",className:"status",size:"small"},c.a.createElement(k.a.Item,{label:"\u8fde\u63a5\u72b6\u6001"},c.a.createElement(x.a,{checked:o,disabled:!0})),c.a.createElement(k.a.Item,{label:"\u8235\u673a PWM"},c.a.createElement(R.a,{style:{margin:"0 16px"},value:u,onChange:r})),c.a.createElement(k.a.Item,{label:"\u7535\u8c03 PWM"},c.a.createElement(R.a,{style:{margin:"0 16px"},value:f,onChange:n})),c.a.createElement(k.a.Item,{label:"\u6444\u50cf\u5934"},c.a.createElement(x.a,{checked:W,onChange:function(t){e.setState({playerEnabled:t})}})),c.a.createElement(k.a.Item,{label:"\u5168\u5c4f"},c.a.createElement(S.a,{type:"primary",shape:"circle",icon:c.a.createElement(b.a,null),onClick:function(){e.appRef.current.requestFullscreen()}}))),c.a.createElement(w.a,null,c.a.createElement(X,{tab:"\u63a7\u5236",key:1,className:"control-pane"},c.a.createElement(k.a,{className:"controller",size:"small",layout:"inline"},c.a.createElement(k.a.Item,null,c.a.createElement(S.a,{type:"danger",onClick:function(){e.setState({base:Object(l.a)({},$)})},icon:c.a.createElement(E.a,null)},"\u8235\u673a\u6821\u51c6")),c.a.createElement(k.a.Item,{label:"\u8235\u673a\u53cd\u5411"},c.a.createElement(x.a,{checked:d,onChange:function(t){e.setState({directionReverse:t})}}))),c.a.createElement(S.a,{className:"forward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){e.setState({hold:!0}),e.changeSpeed(p)},onTouchEnd:function(){e.setState({hold:!1}),e.changeSpeed(h)},icon:c.a.createElement(g.a,null)}),c.a.createElement(S.a,{className:"backward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){e.setState({hold:!0}),e.changeSpeed(m)},onTouchEnd:function(){e.setState({hold:!1}),e.changeSpeed(h)},icon:c.a.createElement(y.a,null)})),c.a.createElement(X,{tab:"\u8bbe\u7f6e",key:"setting"},c.a.createElement(k.a,B,c.a.createElement(k.a.Item,{label:"\u7535\u8c03\u65e0\u8f93\u51fa PWM \u7a7a\u5360\u6bd4"},c.a.createElement(j.a,{value:h,min:0,max:100,onChange:function(t){e.changeZeroSpeedRate(t),v.a.set("speedZeroRate",t)},included:!1,tooltipVisible:!0,marks:_,disabled:!0})),c.a.createElement(k.a.Item,{label:"\u7535\u8c03\u6700\u5927 PWM \u7a7a\u5360\u6bd4"},c.a.createElement(j.a,{value:p,min:h,max:100,onChange:function(t){e.setState({speedMaxRate:t}),v.a.set("speedMaxRate",t)},marks:_})),c.a.createElement(k.a.Item,{label:"\u7535\u8c03\u53cd\u5411\u6700\u5927 PWM \u7a7a\u5360\u6bd4"},c.a.createElement(j.a,{value:m,min:0,max:h,onChange:function(t){e.setState({speedReverseMaxRate:t}),v.a.set("speedReverseMaxRate",t)},marks:_})))),c.a.createElement(X,{tab:"\u8fde\u63a5",key:3},c.a.createElement(k.a,Object.assign({},B,{onFinish:t,initialValues:{wsAddress:I,playerWsAddress:M}}),c.a.createElement("br",null),c.a.createElement(k.a.Item,{label:"\u63a7\u5236\u8fde\u63a5\u5730\u5740",name:"wsAddress",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740!"}]},c.a.createElement(O.a,null)),c.a.createElement(k.a.Item,{label:"\u5a92\u4f53\u8fde\u63a5\u5730\u5740",name:"playerWsAddress"},c.a.createElement(O.a,null)),c.a.createElement(k.a.Item,H,o?c.a.createElement(S.a,{type:"danger",onClick:a},"\u65ad\u5f00"):c.a.createElement(S.a,{type:"primary",htmlType:"submit"},"\u8fde\u63a5")))),c.a.createElement(X,{tab:"\u8c03\u8bd5",key:4},c.a.createElement(k.a.Item,{label:"\u7535\u8c03"},c.a.createElement(j.a,{value:f,min:0,max:100,onChange:n})),c.a.createElement(k.a.Item,{label:"\u8235\u673a"},c.a.createElement(j.a,{value:u,min:0,max:100,onChange:r}))),c.a.createElement(X,{tab:"Ai",key:"ai"},c.a.createElement(Q,{canvasRef:z,action:N,controller:s,onAi:function(t){return e.setState({isAiControlling:t})}}))),c.a.createElement(A,{disabled:!W,address:M,setCanvasRef:function(t){e.setState({canvasRef:t})}}),c.a.createElement(C,{controller:s}))}}]),a}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[178,1,2]]]);
//# sourceMappingURL=main.2461584e.chunk.js.map